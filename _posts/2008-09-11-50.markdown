---
layout: post
title: "Ваш JBoss AS еще не летает? Тогда мы идем к вам :)"
permalink: /posts/50/index.html
tags:
  - jboss
  - tuning
---
Я забыл рассказать еще про одну фишку, которая ускорит работу вашего JBAS'a (JBAS == JBoss AS).

Большинство людей не знает, что такое <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/rmi/dgc/package-summary.html">RMI DGC</a>. И большинству людей не нужно знать, что такое <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/rmi/dgc/package-summary.html">RMI DGC</a>. Это я к тому, что мы с вами не входим в это большинство, так что по ссылке сходить стоит. Благо, текста там немного. 

Вне зависимости от того, используете ли вы в своем коде RMI или нет, JBAS подгружает подсистему RMI. По умолчанию, подсистема RMI запускает принудительную очистку мусора один раз в минуту. Это означает, что все потоки ставятся на паузу и проводится полное сканирование кучи. Это занимает довольно много времени, особенно, если сервер сильно  нагружен. 

Короче, чтобы JBOSS работал побыстрее, вставь эту строку в run.conf (который, напоминаю, расположен в $JBOSS_HOME/bin) куда-нибудь после того IF-a, что мы изменяли в <a href="http://ulizko.com/posts/45/index.html">предыдущей</a> статье:

{% highlight bash %}
JAVA_OPTS="$JAVA_OPTS -Dsun.rmi.dgc.client.gcInterval=3600000 \
-Dsun.rmi.dgc.server.gcInterval=3600000"
{% endhighlight %}

(Обратный слэш  в данном случае не имеет никакого значения, он просто экранирует перевод каретки, чтобы строка кода влезла в формат поста. Когда будешь вставлять эту строку, можешь просто срастить эти две строки в одну, а слэш удалить.)

Есть еще один вариант. Можно запретить любому коду (в том числе и RMI подсистеме) запускать принудительную очистку мусора ,так что вместо вышеуказанных опций можно указать <code>XX:+DisableExplicitGC</code>. В этом случае сборка мусора будет запускаться если куча будет заполнена примерно на 70% (это дефолтное значение и оно тоже настраивается).

Какой из двух вариантов использовать? Не знаю, пока тестирую оба, посмотрим, что получится. 

Возникает вопрос, а когда нужно это поведение-по-умолчанию RMI DGC? Никогда. Конечно, если твой код выполняет кучу вызовов удаленных объектов (remote object calls) (EJB, привет! :) и при этом не кэширует ваши LOCAL или REMOTE объекты, то тогда, _возможно_, очистки мусора раз в час будет недостаточно. 

Те, кто хотят узнать побольше про управлению памятью, могут почитать вот <a href="http://ulizko.com/posts/44/index.html">эти</a> <a href="http://ulizko.com/posts/45/index.html">мои</a> статьи.