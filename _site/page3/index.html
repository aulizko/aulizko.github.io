<!DOCTYPE html>
<html lang="en">
<head>
	<title>Alexander's Ulizko blog</title>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" />
</head>
<body>
<div id="wrapper">
	<div id="header">
    	<h1><a href="/">Alexander's Ulizko blog</a></h1>
	</div><!-- close:header -->
    <div id="content">
		<div id="main-content">

            
	<div class="post" id="post-/posts/338/338">
		<h2><a href="/posts/338/index.html" rel="bookmark" title="По горячим следам: запись скринкаста">По горячим следам: запись скринкаста</a></h2>
		<span class="date">2009 / 02 / 22</span>
		<div class="entry">
			<p>Вчера я потратил вечер, записывая скринкаст. Нервов было израсходовано много, и в этом посте я собираюсь поделиться с вами своими впечатлениями от процесса и размышлениями на тему.</p>

<p>Итак. Что касается виновника торжества, то вот он:</p>
<object height='251' width='400' data='http://vimeo.com/moogaloop.swf?clip_id=3310996&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;color=00ADEF&amp;fullscreen=1' type='application/x-shockwave-flash'><param name='allowfullscreen' value='true' /><param name='allowscriptaccess' value='always' /><param name='src' value='http://vimeo.com/moogaloop.swf?clip_id=3310996&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;color=00ADEF&amp;fullscreen=1' /></object>
<p><a href='http://vimeo.com/3310996'>TweetDeck screencast (rus)</a> от <a href='http://vimeo.com/user1053824'>Александра Улизько</a> на <a href='http://vimeo.com'>Vimeo</a>.</p>

<p>На мой взгляд, получилось гораздо лучше, нежели в <a href='http://ulizko.com/posts/210/index.html'>прошлый раз</a>, но до сколько-нибудь нормального уровня скринкаст все еще не дотягивает. Из замеченных недостатков:</p>

<p><em>ВНЕЗАПНО</em> прорезавшийся вологодский акцент - абсолютно непонятно, откуда он взялся, но, тем не менее, в отдельных местах я отчетливо окаю.</p>

<p>Язык убегает вперед головы&#160;&#8212; иногда не&#160;согласованы рода и&#160;числа, предложения остаются оборваны. Вы&#160;бы видели, как хохотал <a href='http://proxiper.livejournal.com'>proxiper</a>, когда, я&#160;пять раз подряд записывал фразу &#171;зарегистрировался в&#160;сервисе&#187;, потому что с&#160;языка упорно слетало слово &#171;сервер&#187;. Как с&#160;этим бороться, я&#160;не&#160;знаю, если честно&#160;&#8212; заучивать текст мне кажется глупым, но&#160;иного способа говорить четко и&#160;без оговорок я&#160;не&#160;знаю. Может быть, кто-нибудь из&#160;более опытных товарищей поделится?</p>

<p>Откровенно странное качество записи&#160;&#8212; писалось все на&#160;встроенный в&#160;макбук микрофон в&#160;течении достаточно длительного времени, от&#160;этого голос время от&#160;времени меняется, что вы&#160;наверняка заметили. Думаю, при наличии нормального микрофона и&#160;сокращении времени записи конкретно этот недостаток можно изжить.</p>
<a href='/images/tweetdeck_screencast/tweetdeck_screencast_plan.png'><img alt='План скринкаста о tweetdeck&apos;e' height='150' width='150' src='images/tweetdeck_screencast/tweetdeck_screencast_plan-150x150.png' title='План скринкаста о tweetdeck&apos;e' /></a>
<p>Сделав выводы из&#160;прошлого скринкаста, я&#160;решил, что записывать одновременно видео, звуки клавиатуры и&#160;речь&#160;&#8212; не&#160;комильфо, по&#160;крайней мере, мне еще далеко до&#160;такого уровня мастерства, так что я&#160;сделал себе такой вот план и&#160;решил сначала по&#160;нему записать видео, а&#160;потом поверх наложить звук. Собственно, результат действительно оказался гораздо лучше, чем в&#160;прошлый раз, но&#160;тоже изобилует недостатками. Короче, это было правильное решение, надо и&#160;дальше действовать так.</p>
<img alt='Монтаж скринкаста' height='150' width='150' class='size-thumbnail wp-image-340' src='/images/tweetdeck_screencast/dhcdhndhdhndhnn-3.png' title='Монтаж скринкаста' />
<p>Неправильный выбор программы для записи и&#160;редактирования&#160;&#8212; я&#160;записывал все в&#160;программу <a href='http://www.varasoftware.com/products/screenflow/'>screenflow</a>. Точнее даже, записывает-то она вполне прилично, но&#160;вот редактирование в&#160;ней совершенно не&#160;предусмотренно. Например, совершенно невозможно взять отдельный кадр из&#160;видео и&#160;показывать только его, а&#160;звук пускай идет дальше&#160;&#8212; иногда это полезно, так как не&#160;успеваешь проговорить все, что собирался. Также, совершенно дико реализован процесс дозаписи кусочков звука&#160;&#8212; чем-то процесс мне напоминает далекую молодость, когда я&#160;мышкой накликивал в&#160;cakewalk 9&#160;<nobr>midi-партии.</nobr> Возникают точно такие&#160;же ощущения бессмысленной и&#160;лишней работы&#160;&#8212; но, черт возьми, уже сколько лет-то прошло? Должен&#160;же прогресс уйти вперед&#160;не?</p>

<p>В общем, выводы из всего этого такие:</p>

<p>* Скринкасты делать весело и интересно * Нужна какая-то более удобная программа для редактирования видео * Нужно что-то сделать с речью - перед зеркалом тренироваться, что ли</p>

<p>Хотелось&#160;бы, разумеется, услышать ваши отзывы и&#160;критику. Ну&#160;и&#160;если кто знает решение одной из&#160;перечисленный проблем&#160;&#8212; поделитесь, пожалуйста.</p>
		</div>
	</div><!-- close:post -->

	<div class="post" id="post-/posts/334/334">
		<h2><a href="/posts/334/index.html" rel="bookmark" title="Букмарклеты">Букмарклеты</a></h2>
		<span class="date">2009 / 02 / 16</span>
		<div class="entry">
			<p>Всем привет, сегодня речь пойдет про использование букмарклета, или закладки для браузера.</p>

<p>Кто не&#160;знает, это такая штука, которую можно добавить в&#160;закладки (да,&#160;я&#160;сегодня дебютирую в&#160;роли Капитана Очевидность :) и,&#160;при нажатии на&#160;нее, произвести какой-нибудь эффект.</p>

<p>Примером может служить герой сегодняшней заметки, который расположен по&#160;адресу <a href='http://ulizko.com/demo/allthat/'>http://ulizko. com/demo/allthat/</a>. Инструкция по&#160;применению:</p>

<ul>
<li>Перетащите ссылку &#171;link&#187; на&#160;панель закладок или щелкните по&#160;ней правой кнопкой мыши и&#160;выберите пункт меню &#171;добавить в&#160;избранное&#187;.</li>

<li>Зайдите на&#160;какой-нибудь сайт, вроде <a href='http://twitter.com'>http://twitter. com</a>, и&#160;нажмите на&#160;эту закладку (ну&#160;или на&#160;избранное).</li>
</ul>

<p>Появится окошко, в&#160;которое можно ввести данные. Вообще, предполагается, что это будет интерфейс добавления желаний в&#160;вишлисты (предварительно созданные на&#160;каком-то сайте), настроить триггеры оповещений, и&#160;прочее. Есть даже какая-то валидация начального уровня. И&#160;налажен обмен данными с&#160;сервером&#160;&#8212; то&#160;есть, на&#160;любом домене к&#160;вам приходит список ваших вишлистов, а&#160;ваше новое желание с&#160;любого домена долетит на&#160;крыльях любви к&#160;вишлисту и&#160;уютно устроится в&#160;его объятьях<sup><a href='#footnotes_wtf'>1</a></sup>.</p>

<p>Но. Мы&#160;сегодня не&#160;об&#160;этом, а&#160;о&#160;том, как делать такие штуки в&#160;принципе.</p>

<p>Прежде чем перейти непосредственно к&#160;разбору кода, хотелось&#160;бы ответить на&#160;вопрос (который мне никто не&#160;задавал :), а именно, &#34;Какие возможности дает букмарклет?&#34;. Правильный ответ&#160;&#8212; любые. Так как мы&#160;получаем возможность подгрузить любой скрипт, мы&#160;можем сделать с&#160;клиентской страничкой все, что угодно. Например&#160;&#8212; сделать &#171;выносной&#187; виджет, в&#160;котором на&#160;любой страничке можно будет добавить запись в&#160;блокнот или таскменджер. Или вообще сделать весь таскменеджер выносным. Что тоже важно, они будут работать практически везде&#160;&#8212; это не&#160;плагины к&#160;firefox&#146;у&#160;и&#160;не виджеты к&#160;opera. Букмарклетам не&#160;важно (ну,&#160;почти :), какая у&#160;вас ОС&#160;или браузер. В&#160;общем, есть простор для фантазии.</p>

<p>Итак, как&#160;же делать эти самые букмарклеты?</p>

<p>Очень просто: надо создать на&#160;страничке элемент anchor с&#160;атрибутом href, содержащим javascript-код. Если перевести на&#160;русский, то&#160;надо сделать вот такую ссылку, адрес которой, по&#160;большому счету, и&#160;будет букмарклетом:</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;javascript:alert(&#39;I am bookmarklet&#39;); void 0;&quot;</span><span class='nt'>&gt;</span>Bookmarklet<span class='nt'>&lt;/a&gt;</span>
</code></pre></div>
<p>Демо:</p>
<a href='javascript:alert(&apos;I am bookmarklet&apos;); void 0;'>Демо вышеописанного кода</a>
<p>Для того, чтобы javascript код в&#160;адресе ссылки заработал, надо добавить перед ним слово <code>javascript:</code>. По&#160;умному это называется &#171;указание псевдопротокола javascript&#187;. Еще одна важная деталь&#160;&#8212; если ваш код вернет какое-то значение, то&#160;браузер воспримет его в&#160;качестве адреса, по&#160;которому нужно перейти, и&#160;уйдет с&#160;текущей страницы. Чтобы избежать этого, не&#160;возвращайте значения, то&#160;есть допишите в&#160;конец скрипта <code>void 0;</code>, либо оберните весь код в&#160;анонимную функцию, невозвращающую значения&#160;&#8212; <code>(function(){... ваш код мог бы быть здесь...})()</code>.</p>

<p>В любом случае, все эти вопросы подробно рассмотрены у&#160;Ильи Кантора в&#160;его заметке <a href='http://javascript.ru/unsorted/bookmarklet'>Букмарклеты и&nbsp;правила их&nbsp;написания</a>, к&#160;которой я&#160;вас и&#160;отсылаю за&#160;подробностями.</p>

<p>Единственную вещь, которую нам еще нужно знать&#160;&#8212; это то,&#160;что все браузеры ограничивают максимальную длину кода букмарклета. И,&#160;подобно тому, как скорость каравана равна скорости самого медленного верблюда, так и&#160;максимальный размер кроссбраузерного букмарклета равен ограничению, наложенному IE&#160;6&#160;SP2, то&#160;есть, 488&#160;символам.</p>

<p>Таким образом, вряд&#160;ли мы&#160;сможем закодить какую-то комплексную логику в&#160;неполных пятистах символах, так что чаще всего букмарклеты просто создают новый тэг script, в&#160;который уже сгружают код приложения.</p>

<p>Так поступил и&#160;я.&#160;Вот код моего букмарклета в&#160;человекоадаптированном виде:</p>
<div class='highlight'><pre><code class='javascript'><span class='lineno'> 1</span> <span class='p'>(</span><span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'> 2</span>     <span class='c1'>// создаем новую внутреннюю переменную a (лучше в данном случае использовать короткие идентификаторы)</span>
<span class='lineno'> 3</span>     <span class='c1'>// и сразу же добавляем свой объект в глобальный объект window, и записываем в него данные, которые уникальны</span>
<span class='lineno'> 4</span>     <span class='c1'>// для каждого пользователя (ведь они сгенерированы сервером для пользователя перед тем, как он добавил этот букмарклет к себе)</span>
<span class='lineno'> 5</span>     <span class='kd'>var</span> <span class='nx'>a</span> <span class='o'>=</span> <span class='nb'>window</span><span class='p'>.</span><span class='nx'>allThat</span> <span class='o'>=</span> <span class='p'>{</span> 
<span class='lineno'> 6</span>         <span class='nx'>userId</span> <span class='o'>:</span> <span class='s1'>&#39;123345456&#39;</span><span class='p'>,</span>
<span class='lineno'> 7</span>         <span class='nx'>server</span> <span class='o'>:</span> <span class='s1'>&#39;http://mysite.com/&#39;</span><span class='p'>,</span>
<span class='lineno'> 8</span>         <span class='nx'>script</span> <span class='o'>:</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>createElement</span><span class='p'>(</span><span class='s1'>&#39;script&#39;</span><span class='p'>),</span> <span class='c1'>// создадим и запомним тэг скрипт, </span>
<span class='lineno'> 9</span>         <span class='c1'>// который сгрузит нам код нашего приложения - мы его потом удалим, если пользователь нажмет кнопку &quot;закрыть&quot;</span>
<span class='lineno'>10</span>         <span class='nx'>css</span> <span class='o'>:</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>createElement</span><span class='p'>(</span><span class='s1'>&#39;link&#39;</span><span class='p'>)</span>
<span class='lineno'>11</span>     <span class='p'>},</span>
<span class='lineno'>12</span>     <span class='cm'>/* динамически создаем элементы: */</span>
<span class='lineno'>13</span>     <span class='nx'>h</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>getElementsByTagName</span><span class='p'>(</span><span class='s1'>&#39;head&#39;</span><span class='p'>)[</span><span class='mi'>0</span><span class='p'>];</span>
<span class='lineno'>14</span>     <span class='nx'>a</span><span class='p'>.</span><span class='nx'>css</span><span class='p'>.</span><span class='nx'>rel</span> <span class='o'>=</span> <span class='s1'>&#39;stylesheet&#39;</span><span class='p'>;</span>
<span class='lineno'>15</span>     <span class='nx'>a</span><span class='p'>.</span><span class='nx'>css</span><span class='p'>.</span><span class='nx'>href</span> <span class='o'>=</span> <span class='nx'>a</span><span class='p'>.</span><span class='nx'>server</span> <span class='o'>+</span> <span class='s1'>&#39;css/bookmarklet.2.css&#39;</span><span class='p'>;</span>
<span class='lineno'>16</span>     <span class='nx'>h</span><span class='p'>.</span><span class='nx'>appendChild</span><span class='p'>(</span><span class='nx'>a</span><span class='p'>.</span><span class='nx'>css</span><span class='p'>);</span>
<span class='lineno'>17</span>     <span class='nx'>a</span><span class='p'>.</span><span class='nx'>script</span><span class='p'>.</span><span class='nx'>src</span> <span class='o'>=</span> <span class='nx'>a</span><span class='p'>.</span><span class='nx'>server</span> <span class='o'>+</span> <span class='s1'>&#39;js/bookmarklet.7.js&#39;</span><span class='p'>;</span>
<span class='lineno'>18</span>     <span class='nx'>h</span><span class='p'>.</span><span class='nx'>appendChild</span><span class='p'>(</span><span class='nx'>a</span><span class='p'>.</span><span class='nx'>script</span><span class='p'>);</span>
<span class='lineno'>19</span>     <span class='nx'>h</span><span class='o'>=</span><span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>20</span> <span class='p'>})();</span>
</code></pre></div>
<p>Потом подгружается непосредственно код самого окошка. Думаю, он&#160;может представлять некий интерес сам по&#160;себе, так что и&#160;его я&#160;сюда запощу (все комментарии идут на&#160;английском, так как заказчик американец):</p>
<div class='highlight'><pre><code class='javascript'><span class='lineno'>  1</span> <span class='p'>(</span><span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>  2</span> <span class='kd'>var</span> <span class='nx'>Dom</span> <span class='o'>=</span> <span class='p'>{</span>
<span class='lineno'>  3</span>     <span class='nx'>get</span> <span class='o'>:</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'>  4</span>         <span class='k'>return</span> <span class='p'>(</span><span class='nx'>el</span> <span class='o'>&amp;&amp;</span> <span class='nx'>el</span><span class='p'>.</span><span class='nx'>nodeType</span><span class='p'>)</span> <span class='o'>?</span> <span class='nx'>el</span> <span class='o'>:</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>getElementById</span><span class='p'>(</span><span class='nx'>el</span><span class='p'>);</span> 
<span class='lineno'>  5</span>     <span class='p'>},</span>
<span class='lineno'>  6</span>     <span class='nx'>addListener</span> <span class='o'>:</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'>  7</span>             <span class='k'>if</span> <span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>addEventListener</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'>  8</span>                 <span class='k'>return</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'>  9</span>                     <span class='nx'>el</span><span class='p'>.</span><span class='nx'>addEventListener</span><span class='p'>(</span><span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>,</span> <span class='kc'>false</span><span class='p'>);</span> 
<span class='lineno'> 10</span>                 <span class='p'>};</span> 
<span class='lineno'> 11</span>             <span class='p'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>attachEvent</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'> 12</span>                 <span class='k'>return</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'> 13</span>                     <span class='nx'>el</span><span class='p'>.</span><span class='nx'>attachEvent</span><span class='p'>(</span><span class='s1'>&#39;on&#39;</span> <span class='o'>+</span> <span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>);</span> 
<span class='lineno'> 14</span>                 <span class='p'>};</span> 
<span class='lineno'> 15</span>             <span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span> 
<span class='lineno'> 16</span>                 <span class='k'>return</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'> 17</span>                     <span class='nx'>el</span><span class='p'>[</span><span class='s1'>&#39;on&#39;</span> <span class='o'>+</span> <span class='nx'>type</span><span class='p'>]</span> <span class='o'>=</span> <span class='nx'>fn</span><span class='p'>;</span> 
<span class='lineno'> 18</span>                 <span class='p'>};</span> 
<span class='lineno'> 19</span>             <span class='p'>}</span> 
<span class='lineno'> 20</span>         <span class='p'>}(),</span>
<span class='lineno'> 21</span>     <span class='nx'>removeListener</span> <span class='o'>:</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'> 22</span>             <span class='k'>if</span> <span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>removeEventListener</span><span class='p'>){</span> 
<span class='lineno'> 23</span>                 <span class='k'>return</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'> 24</span>                     <span class='nx'>el</span><span class='p'>.</span><span class='nx'>removeEventListener</span><span class='p'>(</span><span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>,</span> <span class='kc'>false</span><span class='p'>);</span> 
<span class='lineno'> 25</span>                 <span class='p'>};</span> 
<span class='lineno'> 26</span>             <span class='p'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>detachEvent</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'> 27</span>                 <span class='k'>return</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'> 28</span>                     <span class='nx'>el</span><span class='p'>.</span><span class='nx'>detachEvent</span><span class='p'>(</span><span class='s1'>&#39;on&#39;</span> <span class='o'>+</span> <span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>);</span> 
<span class='lineno'> 29</span>                 <span class='p'>};</span> 
<span class='lineno'> 30</span>             <span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span> 
<span class='lineno'> 31</span>                 <span class='k'>return</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>,</span> <span class='nx'>type</span><span class='p'>,</span> <span class='nx'>fn</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'> 32</span>                     <span class='nx'>el</span><span class='p'>[</span><span class='s1'>&#39;on&#39;</span> <span class='o'>+</span> <span class='nx'>type</span><span class='p'>]</span> <span class='o'>=</span> <span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span> <span class='k'>return</span> <span class='kc'>true</span><span class='p'>;</span> <span class='p'>};</span> 
<span class='lineno'> 33</span>                 <span class='p'>};</span> 
<span class='lineno'> 34</span>             <span class='p'>}</span> 
<span class='lineno'> 35</span>         <span class='p'>}(),</span>
<span class='lineno'> 36</span>     <span class='nx'>hide</span> <span class='o'>:</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>)</span> <span class='p'>{</span>
<span class='lineno'> 37</span>         <span class='nx'>el</span><span class='p'>.</span><span class='nx'>style</span><span class='p'>.</span><span class='nx'>display</span> <span class='o'>=</span> <span class='s1'>&#39;none&#39;</span><span class='p'>;</span>
<span class='lineno'> 38</span>     <span class='p'>},</span>
<span class='lineno'> 39</span>     <span class='nx'>show</span> <span class='o'>:</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>)</span> <span class='p'>{</span>
<span class='lineno'> 40</span>         <span class='nx'>el</span><span class='p'>.</span><span class='nx'>style</span><span class='p'>.</span><span class='nx'>display</span> <span class='o'>=</span> <span class='s1'>&#39;&#39;</span><span class='p'>;</span>
<span class='lineno'> 41</span>     <span class='p'>}</span>
<span class='lineno'> 42</span> <span class='p'>},</span>
<span class='lineno'> 43</span> 
<span class='lineno'> 44</span> <span class='nx'>allThat</span> <span class='o'>=</span> <span class='nb'>window</span><span class='p'>.</span><span class='nx'>allThat</span><span class='p'>;</span>
<span class='lineno'> 45</span> 
<span class='lineno'> 46</span> <span class='nx'>allThat</span><span class='p'>.</span><span class='nx'>Bookmarklet</span> <span class='o'>=</span> <span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'> 47</span>     <span class='c1'>// where to send user data and where from take wishlists list</span>
<span class='lineno'> 48</span>     <span class='kd'>var</span> <span class='nx'>wishlistsLocation</span> <span class='o'>=</span> <span class='nx'>allThat</span><span class='p'>.</span><span class='nx'>server</span> <span class='o'>+</span> <span class='s1'>&#39;wishlists/&#39;</span><span class='p'>,</span>
<span class='lineno'> 49</span>     <span class='nx'>sendTo</span> <span class='o'>=</span> <span class='nx'>allThat</span><span class='p'>.</span><span class='nx'>server</span> <span class='o'>+</span> <span class='s1'>&#39;wishes/&#39;</span><span class='p'>,</span>
<span class='lineno'> 50</span> 
<span class='lineno'> 51</span>     <span class='c1'>// bookmarklet window html code</span>
<span class='lineno'> 52</span>     <span class='nx'>innerHTML</span> <span class='o'>=</span> <span class='s1'>&#39;&lt;div id=&quot;allthat-wish&quot;&gt;&lt;div class=&quot;allthat-saving&quot; id=&quot;allthat-throbber&quot;&gt;saving...&lt;/div&gt;&lt;div id=&quot;allthat-logo&quot;&gt;&lt;span&gt;AllThat&lt;/span&gt;&lt;/div&gt;&lt;button title=&quot;close&quot; id=&quot;allthat-close&quot;&gt;&lt;span&gt;close&lt;/span&gt;&lt;/button&gt;&lt;h1&gt;&lt;span&gt;Add To Wishlist&lt;/span&gt;&lt;/h1&gt;&lt;form action=&quot;&quot;&gt;&lt;div class=&quot;allthat-field&quot;&gt;&lt;label for=&quot;allthat-product&quot;&gt;Product Name:&lt;/label&gt;&lt;br /&gt;&lt;input type=&quot;text&quot; name=&quot;product&quot; value=&quot;(Ex: Black iPhone Adapter)&quot; class=&quot;allthat-sample-value&quot; id=&quot;allthat-product&quot; /&gt;&lt;/div&gt;	&lt;div class=&quot;allthat-field&quot;&gt;&lt;label for=&quot;allthat-wishlist&quot;&gt;Add to List:&lt;/label&gt;&lt;br /&gt;&lt;select name=&quot;wishlist&quot; id=&quot;allthat-wishlist&quot;&gt;&lt;/select&gt;&lt;/div&gt;&lt;fieldset id=&quot;allthat-low-price&quot;&gt;	&lt;h2&gt;Low Price Alerts!&lt;/h2&gt;			&lt;div class=&quot;allthat-field&quot; id=&quot;allthat-range&quot;&gt;&lt;label for=&quot;allthat-minprice&quot;&gt;How much would you like to pay?&lt;/label&gt;&lt;br /&gt;&lt;input type=&quot;text&quot; name=&quot;minprice&quot; value=&quot;(min)&quot; class=&quot;allthat-sample-value&quot; id=&quot;allthat-minprice&quot; /&gt;to&lt;input type=&quot;text&quot; name=&quot;maxprice&quot; value=&quot;(max)&quot; class=&quot;allthat-sample-value&quot; id=&quot;allthat-maxprice&quot; /&gt;&lt;/div&gt;&lt;h3&gt;Alert me via:&lt;/h3&gt;&lt;fieldset id=&quot;allthat-alerts&quot;&gt;&lt;input type=&quot;checkbox&quot; name=&quot;email&quot; id=&quot;allthat-email&quot; /&gt;&lt;label for=&quot;allthat-email&quot; id=&quot;allthat-email-label&quot;&gt;Email&lt;/label&gt;&lt;br /&gt;&lt;input type=&quot;checkbox&quot; name=&quot;sms&quot; id=&quot;allthat-sms&quot; /&gt;&lt;label for=&quot;allthat-sms&quot; id=&quot;allthat-sms-label&quot;&gt;SMS&lt;/label&gt;&lt;br /&gt;&lt;input type=&quot;checkbox&quot; name=&quot;twitter&quot; id=&quot;allthat-twitter&quot; /&gt;&lt;label for=&quot;allthat-twitter&quot; id=&quot;allthat-twitter-label&quot;&gt;Twitter&lt;/label&gt;&lt;br /&gt;&lt;select name=&quot;frequency&quot; id=&quot;allthat-frequency&quot;&gt;&lt;option value=&quot;0&quot; selected=&quot;selected&quot;&gt;-- Alert Frequency --&lt;/option&gt;&lt;option value=&quot;1&quot;&gt;Daily&lt;/option&gt;&lt;option value=&quot;7&quot;&gt;Weekly&lt;/option&gt;&lt;option value=&quot;30&quot;&gt;Monthly&lt;/option&gt;&lt;/select&gt;&lt;/fieldset&gt;&lt;/fieldset&gt;&lt;button title=&quot;Add&quot; id=&quot;allthat-add&quot;&gt;&lt;span&gt;Add&lt;/span&gt;&lt;/button&gt;&lt;/form&gt;&lt;div id=&quot;allthat-errors&quot; style=&quot;color:red;&quot;/&gt;&lt;/div&gt;&#39;</span><span class='p'>,</span>
<span class='lineno'> 53</span> 
<span class='lineno'> 54</span>     <span class='c1'>// dom elements:</span>
<span class='lineno'> 55</span>     <span class='nx'>container</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>createElement</span><span class='p'>(</span><span class='s1'>&#39;div&#39;</span><span class='p'>),</span>
<span class='lineno'> 56</span>     <span class='nx'>errorDiv</span><span class='p'>,</span>
<span class='lineno'> 57</span>     <span class='nx'>alertFrequencyDropdown</span><span class='p'>,</span>
<span class='lineno'> 58</span>     <span class='nx'>wishlistsDropdown</span><span class='p'>,</span>
<span class='lineno'> 59</span>     <span class='nx'>wishlistsWrapper</span><span class='p'>,</span>
<span class='lineno'> 60</span>     <span class='nx'>savingThrobber</span><span class='p'>,</span>
<span class='lineno'> 61</span>     <span class='nx'>closeButton</span><span class='p'>,</span>
<span class='lineno'> 62</span>     <span class='nx'>titleInput</span><span class='p'>,</span>
<span class='lineno'> 63</span>     <span class='nx'>minPriceInput</span><span class='p'>,</span>
<span class='lineno'> 64</span>     <span class='nx'>maxPriceInput</span><span class='p'>,</span>
<span class='lineno'> 65</span>     <span class='nx'>sendButton</span><span class='p'>,</span>
<span class='lineno'> 66</span>     <span class='nx'>alerts</span> <span class='o'>=</span> <span class='p'>{},</span>
<span class='lineno'> 67</span>     <span class='nx'>scripts</span> <span class='o'>=</span> <span class='p'>[],</span>
<span class='lineno'> 68</span> 
<span class='lineno'> 69</span>     <span class='c1'>// input default values:</span>
<span class='lineno'> 70</span>     <span class='nx'>titleDefaultValue</span> <span class='o'>=</span> <span class='s1'>&#39;(Ex: Black iPhone Adapter)&#39;</span><span class='p'>,</span>
<span class='lineno'> 71</span>     <span class='nx'>minPriceDefaultValue</span> <span class='o'>=</span> <span class='s1'>&#39;(min)&#39;</span><span class='p'>,</span>
<span class='lineno'> 72</span>     <span class='nx'>maxPriceDefaultValue</span> <span class='o'>=</span> <span class='s1'>&#39;(max)&#39;</span><span class='p'>,</span>
<span class='lineno'> 73</span> 
<span class='lineno'> 74</span>     <span class='c1'>// errors array - used for validation</span>
<span class='lineno'> 75</span>     <span class='nx'>errors</span> <span class='o'>=</span> <span class='p'>[],</span>
<span class='lineno'> 76</span>     <span class='nx'>errorMessages</span> <span class='o'>=</span> <span class='p'>{</span>
<span class='lineno'> 77</span>         <span class='nx'>titleEmpty</span> <span class='o'>:</span> <span class='s1'>&#39;Please enter product name&#39;</span><span class='p'>,</span>
<span class='lineno'> 78</span>         <span class='nx'>wishlistNotSelected</span> <span class='o'>:</span> <span class='s1'>&#39;Please chose list&#39;</span><span class='p'>,</span>
<span class='lineno'> 79</span>         <span class='nx'>frequencyNonSelected</span> <span class='o'>:</span> <span class='s1'>&#39;Please chose alert frequency&#39;</span>
<span class='lineno'> 80</span>     <span class='p'>};</span>
<span class='lineno'> 81</span> 
<span class='lineno'> 82</span>     <span class='c1'>// append bookmarklet window html to the target page</span>
<span class='lineno'> 83</span>     <span class='kd'>function</span> <span class='nx'>createTemplate</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'> 84</span>         <span class='nx'>container</span><span class='p'>.</span><span class='nx'>innerHTML</span> <span class='o'>=</span> <span class='nx'>innerHTML</span><span class='p'>;</span>
<span class='lineno'> 85</span>         <span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>appendChild</span><span class='p'>(</span><span class='nx'>container</span><span class='p'>);</span>
<span class='lineno'> 86</span>     <span class='p'>};</span>
<span class='lineno'> 87</span>     <span class='c1'>// initialize javascript references to the Dom elements</span>
<span class='lineno'> 88</span>     <span class='kd'>function</span> <span class='nx'>initializeDomElementsReferences</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'> 89</span>         <span class='nx'>errorDiv</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-errors&#39;</span><span class='p'>);</span>
<span class='lineno'> 90</span>         <span class='nx'>alertFrequencyDropdown</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-frequency&#39;</span><span class='p'>);</span>
<span class='lineno'> 91</span>         <span class='nx'>wishlistsDropdown</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-wishlist&#39;</span><span class='p'>);</span>
<span class='lineno'> 92</span>         <span class='nx'>wishlistsWrapper</span> <span class='o'>=</span> <span class='nx'>wishlistsDropdown</span><span class='p'>.</span><span class='nx'>parentNode</span><span class='p'>;</span>
<span class='lineno'> 93</span>         <span class='nx'>savingThrobber</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-throbber&#39;</span><span class='p'>);</span>
<span class='lineno'> 94</span>         <span class='nx'>closeButton</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-close&#39;</span><span class='p'>);</span>
<span class='lineno'> 95</span>         <span class='nx'>titleInput</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-product&#39;</span><span class='p'>);</span>
<span class='lineno'> 96</span>         <span class='nx'>minPriceInput</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-minprice&#39;</span><span class='p'>);</span>
<span class='lineno'> 97</span>         <span class='nx'>maxPriceInput</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-maxprice&#39;</span><span class='p'>);</span>
<span class='lineno'> 98</span>         <span class='nx'>sendButton</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-add&#39;</span><span class='p'>);</span>
<span class='lineno'> 99</span>         <span class='nx'>alerts</span><span class='p'>.</span><span class='nx'>email</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-email&#39;</span><span class='p'>);</span>
<span class='lineno'>100</span>         <span class='nx'>alerts</span><span class='p'>.</span><span class='nx'>sms</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-sms&#39;</span><span class='p'>);</span>
<span class='lineno'>101</span>         <span class='nx'>alerts</span><span class='p'>.</span><span class='nx'>twitter</span> <span class='o'>=</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;allthat-twitter&#39;</span><span class='p'>);</span>
<span class='lineno'>102</span>     <span class='p'>};</span>
<span class='lineno'>103</span>     <span class='c1'>// disable wishlist dropdown before server response with wishlists array doesn&#39;t arrive</span>
<span class='lineno'>104</span>     <span class='kd'>function</span> <span class='nx'>initializeGUI</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>105</span>         <span class='nx'>wishlistsDropdown</span><span class='p'>.</span><span class='nx'>disabled</span> <span class='o'>=</span> <span class='s1'>&#39;disabled&#39;</span><span class='p'>;</span>
<span class='lineno'>106</span>         <span class='nx'>wishlistsDropdown</span><span class='p'>.</span><span class='nx'>style</span><span class='p'>.</span><span class='nx'>width</span> <span class='o'>=</span> <span class='s1'>&#39;90%&#39;</span><span class='p'>;</span>
<span class='lineno'>107</span>         <span class='nx'>wishlistsWrapper</span> <span class='o'>=</span> <span class='nx'>wishlistsDropdown</span><span class='p'>.</span><span class='nx'>parentNode</span><span class='p'>;</span>
<span class='lineno'>108</span>         <span class='nx'>wishlistsWrapper</span><span class='p'>.</span><span class='nx'>style</span><span class='p'>.</span><span class='nx'>background</span> <span class='o'>=</span> <span class='s1'>&#39;transparent url(&#39;</span> <span class='o'>+</span> <span class='nx'>allThat</span><span class='p'>.</span><span class='nx'>server</span> <span class='o'>+</span> <span class='s1'>&#39;images/bookmarklet/ajax-loader-blue.gif) no-repeat right&#39;</span><span class='p'>;</span>
<span class='lineno'>109</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>hide</span><span class='p'>(</span><span class='nx'>savingThrobber</span><span class='p'>);</span>
<span class='lineno'>110</span>     <span class='p'>};</span>
<span class='lineno'>111</span>     <span class='c1'>// bind event listeners to the controls</span>
<span class='lineno'>112</span>     <span class='kd'>function</span> <span class='nx'>attachListeners</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>113</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>addListener</span><span class='p'>(</span><span class='nx'>closeButton</span><span class='p'>,</span> <span class='s1'>&#39;click&#39;</span><span class='p'>,</span> <span class='nx'>destroy</span><span class='p'>);</span>
<span class='lineno'>114</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>addListener</span><span class='p'>(</span><span class='nx'>titleInput</span><span class='p'>,</span> <span class='s1'>&#39;focus&#39;</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span><span class='k'>if</span> <span class='p'>(</span><span class='nx'>titleInput</span><span class='p'>.</span><span class='nx'>value</span> <span class='o'>==</span> <span class='nx'>titleDefaultValue</span><span class='p'>)</span> <span class='nx'>activateInput</span><span class='p'>(</span><span class='nx'>titleInput</span><span class='p'>);});</span>
<span class='lineno'>115</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>addListener</span><span class='p'>(</span><span class='nx'>minPriceInput</span><span class='p'>,</span> <span class='s1'>&#39;focus&#39;</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span><span class='k'>if</span> <span class='p'>(</span><span class='nx'>minPriceInput</span><span class='p'>.</span><span class='nx'>value</span> <span class='o'>==</span> <span class='nx'>minPriceDefaultValue</span><span class='p'>)</span> <span class='nx'>activateInput</span><span class='p'>(</span><span class='nx'>minPriceInput</span><span class='p'>);});</span>
<span class='lineno'>116</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>addListener</span><span class='p'>(</span><span class='nx'>maxPriceInput</span><span class='p'>,</span> <span class='s1'>&#39;focus&#39;</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span><span class='k'>if</span> <span class='p'>(</span><span class='nx'>maxPriceInput</span><span class='p'>.</span><span class='nx'>value</span> <span class='o'>==</span> <span class='nx'>maxPriceDefaultValue</span><span class='p'>)</span> <span class='nx'>activateInput</span><span class='p'>(</span><span class='nx'>maxPriceInput</span><span class='p'>);});</span>
<span class='lineno'>117</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>addListener</span><span class='p'>(</span><span class='nx'>sendButton</span><span class='p'>,</span> <span class='s1'>&#39;click&#39;</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>e</span><span class='p'>)</span> <span class='p'>{</span> <span class='nx'>e</span> <span class='o'>=</span> <span class='nx'>e</span> <span class='o'>||</span> <span class='nb'>window</span><span class='p'>.</span><span class='nx'>event</span><span class='p'>;</span> <span class='k'>if</span> <span class='p'>(</span><span class='nx'>e</span><span class='p'>.</span><span class='nx'>preventDefault</span><span class='p'>)</span> <span class='nx'>e</span><span class='p'>.</span><span class='nx'>preventDefault</span><span class='p'>();</span> <span class='nx'>addItemToList</span><span class='p'>();</span> <span class='k'>return</span> <span class='kc'>false</span><span class='p'>;});</span>
<span class='lineno'>118</span>     <span class='p'>};</span>
<span class='lineno'>119</span> 
<span class='lineno'>120</span>     <span class='c1'>// validators</span>
<span class='lineno'>121</span>     <span class='kd'>function</span> <span class='nx'>validateItemTitlePresence</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>122</span>         <span class='kd'>var</span> <span class='nx'>t</span> <span class='o'>=</span> <span class='nx'>titleInput</span><span class='p'>.</span><span class='nx'>value</span><span class='p'>;</span>
<span class='lineno'>123</span>         <span class='k'>if</span> <span class='p'>(</span><span class='nx'>t</span><span class='p'>.</span><span class='nx'>replace</span><span class='p'>(</span><span class='sr'>/^s+|s+$/</span><span class='p'>,</span> <span class='s1'>&#39;&#39;</span><span class='p'>).</span><span class='nx'>length</span> <span class='o'>==</span> <span class='mi'>0</span> <span class='o'>||</span> <span class='nx'>t</span> <span class='o'>==</span> <span class='nx'>titleDefaultValue</span><span class='p'>)</span> <span class='nx'>errors</span><span class='p'>.</span><span class='nx'>push</span><span class='p'>(</span><span class='nx'>errorMessages</span><span class='p'>.</span><span class='nx'>titleEmpty</span><span class='p'>);</span>
<span class='lineno'>124</span>     <span class='p'>};</span>
<span class='lineno'>125</span> 
<span class='lineno'>126</span>     <span class='kd'>function</span> <span class='nx'>validateWishlistPresence</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>127</span>         <span class='k'>if</span> <span class='p'>(</span><span class='k'>typeof</span> <span class='nx'>wishlistsDropdown</span><span class='p'>.</span><span class='nx'>value</span> <span class='o'>===</span> <span class='s1'>&#39;undefined&#39;</span><span class='p'>)</span> <span class='nx'>errors</span><span class='p'>.</span><span class='nx'>push</span><span class='p'>(</span><span class='nx'>errorMessages</span><span class='p'>.</span><span class='nx'>wishlistNotSelected</span><span class='p'>);</span>
<span class='lineno'>128</span>     <span class='p'>};</span>
<span class='lineno'>129</span> 
<span class='lineno'>130</span>     <span class='kd'>function</span> <span class='nx'>validateFrequencyPresence</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>131</span>         <span class='k'>for</span> <span class='p'>(</span><span class='kd'>var</span> <span class='nx'>alert</span> <span class='k'>in</span> <span class='nx'>alerts</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'>132</span>             <span class='k'>if</span> <span class='p'>(</span><span class='nx'>alerts</span><span class='p'>[</span><span class='nx'>alert</span><span class='p'>].</span><span class='nx'>checked</span> <span class='o'>&amp;&amp;</span> <span class='nx'>alertFrequencyDropdown</span><span class='p'>.</span><span class='nx'>value</span> <span class='o'>==</span> <span class='mi'>0</span><span class='p'>)</span> <span class='p'>{</span>
<span class='lineno'>133</span>                 <span class='nx'>errors</span><span class='p'>.</span><span class='nx'>push</span><span class='p'>(</span><span class='nx'>errorMessages</span><span class='p'>.</span><span class='nx'>frequencyNonSelected</span><span class='p'>);</span> 
<span class='lineno'>134</span>                 <span class='k'>return</span><span class='p'>;</span>
<span class='lineno'>135</span>             <span class='p'>}</span>
<span class='lineno'>136</span>         <span class='p'>}</span>
<span class='lineno'>137</span>     <span class='p'>};</span>
<span class='lineno'>138</span> 
<span class='lineno'>139</span>     <span class='kd'>function</span> <span class='nx'>validate</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>140</span>         <span class='nx'>errors</span><span class='p'>.</span><span class='nx'>length</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>;</span>
<span class='lineno'>141</span>         <span class='nx'>validateItemTitlePresence</span><span class='p'>();</span>
<span class='lineno'>142</span>         <span class='nx'>validateWishlistPresence</span><span class='p'>();</span>
<span class='lineno'>143</span>         <span class='nx'>validateFrequencyPresence</span><span class='p'>();</span>
<span class='lineno'>144</span>         <span class='k'>return</span> <span class='nx'>errors</span><span class='p'>.</span><span class='nx'>length</span> <span class='o'>==</span> <span class='mi'>0</span><span class='p'>;</span>
<span class='lineno'>145</span>     <span class='p'>};</span>
<span class='lineno'>146</span> 
<span class='lineno'>147</span>     <span class='kd'>function</span> <span class='nx'>displayErrors</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>148</span>         <span class='kd'>var</span> <span class='nx'>output</span> <span class='o'>=</span> <span class='s1'>&#39;&#39;</span><span class='p'>,</span> <span class='nx'>error</span><span class='p'>,</span> <span class='nx'>i</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>;</span>
<span class='lineno'>149</span>         <span class='k'>while</span> <span class='p'>(</span><span class='nx'>error</span> <span class='o'>=</span> <span class='nx'>errors</span><span class='p'>[</span><span class='nx'>i</span><span class='o'>++</span><span class='p'>])</span> <span class='p'>{</span>
<span class='lineno'>150</span>             <span class='nx'>output</span> <span class='o'>+=</span> <span class='nx'>error</span> <span class='o'>+</span> <span class='s1'>&#39;&lt;br/&gt;&#39;</span><span class='p'>;</span>
<span class='lineno'>151</span>         <span class='p'>}</span>
<span class='lineno'>152</span> 
<span class='lineno'>153</span>         <span class='nx'>errorDiv</span><span class='p'>.</span><span class='nx'>innerHTML</span> <span class='o'>=</span> <span class='nx'>output</span><span class='p'>;</span>
<span class='lineno'>154</span>     <span class='p'>};</span>
<span class='lineno'>155</span> 
<span class='lineno'>156</span>     <span class='c1'>// this function called if user clicks on the &#39;send&#39; button</span>
<span class='lineno'>157</span>     <span class='c1'>// so that we need to validate data, and, if it&#39;s all ok,</span>
<span class='lineno'>158</span>     <span class='c1'>// send request to server. Also, we show throbber and setup callback which would stop it</span>
<span class='lineno'>159</span>     <span class='kd'>function</span> <span class='nx'>addItemToList</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>160</span>         <span class='k'>if</span> <span class='p'>(</span><span class='nx'>validate</span><span class='p'>())</span> <span class='p'>{</span>
<span class='lineno'>161</span>             <span class='nx'>sendItemOnServer</span><span class='p'>();</span>
<span class='lineno'>162</span>         <span class='p'>}</span>
<span class='lineno'>163</span>         <span class='nx'>displayErrors</span><span class='p'>();</span>
<span class='lineno'>164</span>     <span class='p'>};</span>
<span class='lineno'>165</span> 
<span class='lineno'>166</span>     <span class='c1'>// serialize data into string, show loader and call sendRequest method</span>
<span class='lineno'>167</span>     <span class='kd'>function</span> <span class='nx'>sendItemOnServer</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>168</span>         <span class='kd'>var</span> <span class='nx'>data</span> <span class='o'>=</span> <span class='s1'>&#39;title=&#39;</span> <span class='o'>+</span> <span class='nb'>encodeURIComponent</span><span class='p'>(</span><span class='nx'>titleInput</span><span class='p'>.</span><span class='nx'>value</span><span class='p'>)</span> <span class='o'>+</span> <span class='s1'>&#39;&amp;wishlist=&#39;</span> <span class='o'>+</span> <span class='nx'>wishlistsDropdown</span><span class='p'>.</span><span class='nx'>value</span><span class='p'>;</span>
<span class='lineno'>169</span> 
<span class='lineno'>170</span>         <span class='kd'>var</span> <span class='nx'>temp</span> <span class='o'>=</span> <span class='nx'>minPriceInput</span><span class='p'>.</span><span class='nx'>value</span><span class='p'>;</span>
<span class='lineno'>171</span>         <span class='nx'>data</span> <span class='o'>+=</span> <span class='p'>(</span><span class='nx'>temp</span> <span class='o'>==</span> <span class='s1'>&#39;&#39;</span> <span class='o'>||</span> <span class='nx'>temp</span> <span class='o'>==</span> <span class='nx'>minPriceDefaultValue</span><span class='p'>)</span> <span class='o'>?</span> <span class='s1'>&#39;&#39;</span> <span class='o'>:</span> <span class='p'>(</span><span class='s1'>&#39;&amp;minPrice=&#39;</span> <span class='o'>+</span> <span class='nx'>temp</span><span class='p'>);</span>
<span class='lineno'>172</span>         <span class='nx'>temp</span> <span class='o'>=</span> <span class='nx'>maxPriceInput</span><span class='p'>.</span><span class='nx'>value</span><span class='p'>;</span>
<span class='lineno'>173</span>         <span class='nx'>data</span> <span class='o'>+=</span> <span class='p'>(</span><span class='nx'>temp</span> <span class='o'>==</span> <span class='s1'>&#39;&#39;</span> <span class='o'>||</span> <span class='nx'>temp</span> <span class='o'>==</span> <span class='nx'>maxPriceDefaultValue</span><span class='p'>)</span> <span class='o'>?</span> <span class='s1'>&#39;&#39;</span> <span class='o'>:</span> <span class='p'>(</span><span class='s1'>&#39;&amp;maxPrice=&#39;</span> <span class='o'>+</span> <span class='nx'>temp</span><span class='p'>);</span>
<span class='lineno'>174</span> 
<span class='lineno'>175</span>         <span class='nx'>data</span> <span class='o'>+=</span> <span class='s1'>&#39;&amp;alerts=[&#39;</span><span class='p'>;</span>
<span class='lineno'>176</span>         <span class='k'>for</span> <span class='p'>(</span><span class='kd'>var</span> <span class='nx'>alert</span> <span class='k'>in</span> <span class='nx'>alerts</span><span class='p'>)</span> <span class='p'>{</span> 
<span class='lineno'>177</span>             <span class='kd'>var</span> <span class='nx'>a</span> <span class='o'>=</span> <span class='nx'>alerts</span><span class='p'>[</span><span class='nx'>alert</span><span class='p'>];</span>
<span class='lineno'>178</span>             <span class='k'>if</span> <span class='p'>(</span><span class='nx'>a</span><span class='p'>.</span><span class='nx'>checked</span><span class='p'>)</span> <span class='p'>{</span>
<span class='lineno'>179</span>                 <span class='nx'>data</span> <span class='o'>+=</span> <span class='nx'>a</span><span class='p'>.</span><span class='nx'>name</span><span class='p'>;</span>
<span class='lineno'>180</span>             <span class='p'>}</span>
<span class='lineno'>181</span>         <span class='p'>}</span>
<span class='lineno'>182</span>         <span class='nx'>data</span> <span class='o'>+=</span> <span class='s1'>&#39;]&#39;</span><span class='p'>;</span>
<span class='lineno'>183</span>         <span class='nx'>data</span> <span class='o'>+=</span> <span class='s1'>&#39;&amp;alertFrequency=&#39;</span> <span class='o'>+</span> <span class='nx'>alertFrequencyDropdown</span><span class='p'>.</span><span class='nx'>value</span><span class='p'>;</span>
<span class='lineno'>184</span> 
<span class='lineno'>185</span>         <span class='nx'>showLoader</span><span class='p'>();</span>
<span class='lineno'>186</span>         <span class='nx'>sendRequest</span><span class='p'>(</span><span class='nx'>sendTo</span><span class='p'>,</span> <span class='nx'>data</span><span class='p'>,</span> <span class='s1'>&#39;itemAdded&#39;</span><span class='p'>);</span>
<span class='lineno'>187</span>     <span class='p'>};</span>
<span class='lineno'>188</span> 
<span class='lineno'>189</span>     <span class='c1'>// clear inputs</span>
<span class='lineno'>190</span>     <span class='kd'>function</span> <span class='nx'>clearFields</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>191</span>         <span class='nx'>hideLoader</span><span class='p'>();</span>
<span class='lineno'>192</span>         <span class='nx'>activateInput</span> <span class='p'>(</span><span class='nx'>titleInput</span><span class='p'>);</span>
<span class='lineno'>193</span>         <span class='nx'>activateInput</span> <span class='p'>(</span><span class='nx'>minPriceInput</span><span class='p'>);</span>
<span class='lineno'>194</span>         <span class='nx'>activateInput</span> <span class='p'>(</span><span class='nx'>maxPriceInput</span><span class='p'>);</span>
<span class='lineno'>195</span>         <span class='k'>for</span> <span class='p'>(</span><span class='kd'>var</span> <span class='nx'>alert</span> <span class='k'>in</span> <span class='nx'>alerts</span><span class='p'>)</span> <span class='nx'>alerts</span><span class='p'>[</span><span class='nx'>alert</span><span class='p'>].</span><span class='nx'>checked</span> <span class='o'>=</span> <span class='kc'>false</span><span class='p'>;</span>
<span class='lineno'>196</span>     <span class='p'>};</span>
<span class='lineno'>197</span> 
<span class='lineno'>198</span>     <span class='c1'>// misc - remove default value and make font color black</span>
<span class='lineno'>199</span>     <span class='kd'>function</span> <span class='nx'>activateInput</span> <span class='p'>(</span><span class='nx'>el</span><span class='p'>)</span> <span class='p'>{</span>
<span class='lineno'>200</span>         <span class='nx'>el</span><span class='p'>.</span><span class='nx'>className</span> <span class='o'>=</span> <span class='s1'>&#39;&#39;</span><span class='p'>;</span>
<span class='lineno'>201</span>         <span class='nx'>el</span><span class='p'>.</span><span class='nx'>value</span> <span class='o'>=</span> <span class='s1'>&#39;&#39;</span><span class='p'>;</span>
<span class='lineno'>202</span>     <span class='p'>};</span>
<span class='lineno'>203</span> 
<span class='lineno'>204</span>     <span class='c1'>// feed wishlists dropdown with data and enable it</span>
<span class='lineno'>205</span>     <span class='kd'>function</span> <span class='nx'>activateWhishlistsDropdown</span> <span class='p'>(</span><span class='nx'>response</span><span class='p'>)</span> <span class='p'>{</span>
<span class='lineno'>206</span>         <span class='kd'>var</span> <span class='nx'>w</span> <span class='o'>=</span> <span class='nx'>response</span><span class='p'>.</span><span class='nx'>wishlists</span><span class='p'>,</span> 
<span class='lineno'>207</span>             <span class='nx'>i</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>,</span> 
<span class='lineno'>208</span>             <span class='nx'>wishlist</span><span class='p'>,</span> 
<span class='lineno'>209</span>             <span class='nx'>opt</span><span class='p'>;</span>
<span class='lineno'>210</span>         <span class='k'>while</span><span class='p'>(</span><span class='nx'>wishlist</span> <span class='o'>=</span> <span class='nx'>w</span><span class='p'>[</span><span class='nx'>i</span><span class='o'>++</span><span class='p'>])</span> <span class='p'>{</span>
<span class='lineno'>211</span>             <span class='nx'>opt</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>createElement</span><span class='p'>(</span><span class='s2'>&quot;option&quot;</span><span class='p'>);</span>
<span class='lineno'>212</span> 			<span class='nx'>opt</span><span class='p'>.</span><span class='nx'>appendChild</span><span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>createTextNode</span><span class='p'>(</span><span class='nx'>wishlist</span><span class='p'>.</span><span class='nx'>title</span><span class='p'>));</span>
<span class='lineno'>213</span> 			<span class='nx'>opt</span><span class='p'>.</span><span class='nx'>setAttribute</span><span class='p'>(</span><span class='s2'>&quot;value&quot;</span><span class='p'>,</span> <span class='nx'>wishlist</span><span class='p'>.</span><span class='nx'>id</span><span class='p'>);</span>
<span class='lineno'>214</span> 			<span class='nx'>wishlistsDropdown</span><span class='p'>.</span><span class='nx'>appendChild</span><span class='p'>(</span><span class='nx'>opt</span><span class='p'>);</span>
<span class='lineno'>215</span>         <span class='p'>}</span>
<span class='lineno'>216</span>         <span class='nx'>wishlistsDropdown</span><span class='p'>.</span><span class='nx'>disabled</span> <span class='o'>=</span> <span class='kc'>false</span><span class='p'>;</span>
<span class='lineno'>217</span>         <span class='nx'>wishlistsDropdown</span><span class='p'>.</span><span class='nx'>style</span><span class='p'>.</span><span class='nx'>width</span> <span class='o'>=</span> <span class='s1'>&#39;100%&#39;</span><span class='p'>;</span>
<span class='lineno'>218</span>         <span class='nx'>wishlistsWrapper</span><span class='p'>.</span><span class='nx'>style</span><span class='p'>.</span><span class='nx'>background</span> <span class='o'>=</span> <span class='s1'>&#39;&#39;</span><span class='p'>;</span>
<span class='lineno'>219</span>     <span class='p'>};</span>
<span class='lineno'>220</span> 
<span class='lineno'>221</span>     <span class='c1'>// remove every track of bookmarklet from the page</span>
<span class='lineno'>222</span>     <span class='kd'>function</span> <span class='nx'>destroy</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>223</span>         <span class='nx'>removeEventListeners</span><span class='p'>();</span>
<span class='lineno'>224</span>         <span class='nx'>removeDOMReferences</span><span class='p'>();</span>
<span class='lineno'>225</span>         <span class='nx'>container</span><span class='p'>.</span><span class='nx'>parentNode</span><span class='p'>.</span><span class='nx'>removeChild</span><span class='p'>(</span><span class='nx'>container</span><span class='p'>);</span>
<span class='lineno'>226</span>         <span class='nx'>container</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>227</span>         <span class='nx'>allThat</span><span class='p'>.</span><span class='nx'>css</span><span class='p'>.</span><span class='nx'>parentNode</span><span class='p'>.</span><span class='nx'>removeChild</span><span class='p'>(</span><span class='nx'>allThat</span><span class='p'>.</span><span class='nx'>css</span><span class='p'>);</span>
<span class='lineno'>228</span>         <span class='nx'>allThat</span><span class='p'>.</span><span class='nx'>script</span><span class='p'>.</span><span class='nx'>parentNode</span><span class='p'>.</span><span class='nx'>removeChild</span><span class='p'>(</span><span class='nx'>allThat</span><span class='p'>.</span><span class='nx'>script</span><span class='p'>);</span>
<span class='lineno'>229</span>         <span class='nx'>allThat</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>230</span>     <span class='p'>};</span>
<span class='lineno'>231</span>     <span class='c1'>// to prevent memory leaks on ie6 - remove all js to dom references</span>
<span class='lineno'>232</span>     <span class='kd'>function</span> <span class='nx'>removeDOMReferences</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>233</span>         <span class='nx'>errorDiv</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>234</span>         <span class='nx'>alertFrequencyDropdown</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>235</span>         <span class='nx'>wishlistsDropdown</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>236</span>         <span class='nx'>wishlistsWrapper</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>237</span>         <span class='nx'>savingThrobber</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>238</span>         <span class='nx'>closeButton</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>239</span>         <span class='nx'>titleInput</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>240</span>         <span class='nx'>minPriceInput</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>241</span>         <span class='nx'>maxPriceInput</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>242</span>         <span class='nx'>sendButton</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>243</span>         <span class='nx'>alerts</span><span class='p'>.</span><span class='nx'>email</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>244</span>         <span class='nx'>alerts</span><span class='p'>.</span><span class='nx'>sms</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>245</span>         <span class='nx'>alerts</span><span class='p'>.</span><span class='nx'>twitter</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>246</span>         <span class='kd'>var</span> <span class='nx'>i</span> <span class='o'>=</span> <span class='nx'>scripts</span><span class='p'>.</span><span class='nx'>length</span> <span class='o'>-</span> <span class='mi'>1</span><span class='p'>,</span> <span class='nx'>script</span><span class='p'>,</span> <span class='nx'>head</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>getElementsByTagName</span><span class='p'>(</span><span class='s1'>&#39;head&#39;</span><span class='p'>)[</span><span class='mi'>0</span><span class='p'>];</span>
<span class='lineno'>247</span>         <span class='k'>while</span> <span class='p'>(</span><span class='nx'>script</span> <span class='o'>=</span> <span class='nx'>scripts</span><span class='p'>[</span><span class='nx'>i</span><span class='o'>--</span><span class='p'>])</span> <span class='p'>{</span>
<span class='lineno'>248</span>             <span class='nx'>head</span><span class='p'>.</span><span class='nx'>removeChild</span><span class='p'>(</span><span class='nx'>script</span><span class='p'>);</span>
<span class='lineno'>249</span>             <span class='nx'>script</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>250</span>             <span class='nx'>scripts</span><span class='p'>[</span><span class='nx'>i</span> <span class='o'>+</span> <span class='mi'>1</span><span class='p'>]</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>251</span>         <span class='p'>}</span>
<span class='lineno'>252</span>         <span class='nx'>scripts</span><span class='p'>.</span><span class='nx'>length</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>253</span>     <span class='p'>};</span>
<span class='lineno'>254</span>     <span class='c1'>// to prevent memory leaks - remove all event listeners</span>
<span class='lineno'>255</span>     <span class='kd'>function</span> <span class='nx'>removeEventListeners</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>256</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>removeListener</span><span class='p'>(</span><span class='nx'>closeButton</span><span class='p'>,</span> <span class='s1'>&#39;click&#39;</span><span class='p'>,</span> <span class='nx'>destroy</span><span class='p'>);</span>
<span class='lineno'>257</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>removeListener</span><span class='p'>(</span><span class='nx'>titleInput</span><span class='p'>,</span> <span class='s1'>&#39;focus&#39;</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span><span class='k'>if</span> <span class='p'>(</span><span class='nx'>titleInput</span><span class='p'>.</span><span class='nx'>value</span> <span class='o'>==</span> <span class='nx'>titleDefaultValue</span><span class='p'>)</span> <span class='nx'>activateInput</span><span class='p'>(</span><span class='nx'>titleInput</span><span class='p'>);});</span>
<span class='lineno'>258</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>removeListener</span><span class='p'>(</span><span class='nx'>minPriceInput</span><span class='p'>,</span> <span class='s1'>&#39;focus&#39;</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span><span class='k'>if</span> <span class='p'>(</span><span class='nx'>minPriceInput</span><span class='p'>.</span><span class='nx'>value</span> <span class='o'>==</span> <span class='nx'>minPriceDefaultValue</span><span class='p'>)</span> <span class='nx'>activateInput</span><span class='p'>(</span><span class='nx'>minPriceInput</span><span class='p'>);});</span>
<span class='lineno'>259</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>removeListener</span><span class='p'>(</span><span class='nx'>maxPriceInput</span><span class='p'>,</span> <span class='s1'>&#39;focus&#39;</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span><span class='k'>if</span> <span class='p'>(</span><span class='nx'>maxPriceInput</span><span class='p'>.</span><span class='nx'>value</span> <span class='o'>==</span> <span class='nx'>maxPriceDefaultValue</span><span class='p'>)</span> <span class='nx'>activateInput</span><span class='p'>(</span><span class='nx'>maxPriceInput</span><span class='p'>);});</span>
<span class='lineno'>260</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>removeListener</span><span class='p'>(</span><span class='nx'>sendButton</span><span class='p'>,</span> <span class='s1'>&#39;click&#39;</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>e</span><span class='p'>)</span> <span class='p'>{</span> <span class='nx'>e</span> <span class='o'>=</span> <span class='nx'>e</span> <span class='o'>||</span> <span class='nb'>window</span><span class='p'>.</span><span class='nx'>event</span><span class='p'>;</span> <span class='k'>if</span> <span class='p'>(</span><span class='nx'>e</span><span class='p'>.</span><span class='nx'>preventDefault</span><span class='p'>)</span> <span class='nx'>e</span><span class='p'>.</span><span class='nx'>preventDefault</span><span class='p'>();</span> <span class='nx'>addItemToList</span><span class='p'>();</span> <span class='k'>return</span> <span class='kc'>false</span><span class='p'>;});</span>
<span class='lineno'>261</span>     <span class='p'>};</span>
<span class='lineno'>262</span> 
<span class='lineno'>263</span>     <span class='c1'>// create dynamic script element and remove it immediately after it load</span>
<span class='lineno'>264</span>     <span class='kd'>function</span> <span class='nx'>sendRequest</span> <span class='p'>(</span><span class='nx'>url</span><span class='p'>,</span> <span class='nx'>data</span><span class='p'>,</span> <span class='nx'>callback</span><span class='p'>)</span> <span class='p'>{</span>
<span class='lineno'>265</span>         <span class='kd'>var</span> <span class='nx'>head</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>getElementsByTagName</span><span class='p'>(</span><span class='s1'>&#39;head&#39;</span><span class='p'>)[</span><span class='mi'>0</span><span class='p'>],</span>
<span class='lineno'>266</span>             <span class='nx'>script</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>createElement</span><span class='p'>(</span><span class='s1'>&#39;script&#39;</span><span class='p'>),</span>
<span class='lineno'>267</span>             <span class='nx'>noCacheIE</span> <span class='o'>=</span> <span class='s1'>&#39;&amp;noCacheIE=&#39;</span> <span class='o'>+</span> <span class='p'>(</span><span class='k'>new</span> <span class='nb'>Date</span><span class='p'>()).</span><span class='nx'>getTime</span><span class='p'>(),</span>
<span class='lineno'>268</span>             <span class='nx'>fullUrl</span> <span class='o'>=</span> <span class='nx'>url</span> <span class='o'>+</span> <span class='s1'>&#39;?callback=&#39;</span> <span class='o'>+</span> <span class='nb'>encodeURIComponent</span><span class='p'>(</span><span class='nx'>callback</span><span class='p'>)</span> <span class='o'>+</span> <span class='s1'>&#39;&amp;userId=&#39;</span> <span class='o'>+</span> <span class='nx'>allThat</span><span class='p'>.</span><span class='nx'>userId</span><span class='o'>+</span> <span class='p'>((</span><span class='nx'>data</span><span class='p'>)</span> <span class='o'>?</span> <span class='p'>(</span><span class='s1'>&#39;&amp;&#39;</span> <span class='o'>+</span> <span class='nx'>data</span><span class='p'>)</span> <span class='o'>:</span> <span class='s1'>&#39;&#39;</span><span class='p'>)</span> <span class='o'>+</span> <span class='nx'>noCacheIE</span><span class='p'>;</span>
<span class='lineno'>269</span> 
<span class='lineno'>270</span>         <span class='nx'>script</span><span class='p'>.</span><span class='nx'>setAttribute</span><span class='p'>(</span><span class='s1'>&#39;type&#39;</span><span class='p'>,</span> <span class='s1'>&#39;text/javascript&#39;</span><span class='p'>);</span>
<span class='lineno'>271</span>         <span class='nx'>script</span><span class='p'>.</span><span class='nx'>setAttribute</span><span class='p'>(</span><span class='s1'>&#39;src&#39;</span><span class='p'>,</span> <span class='nx'>fullUrl</span><span class='p'>);</span>
<span class='lineno'>272</span>         <span class='nx'>script</span><span class='p'>.</span><span class='nx'>setAttribute</span><span class='p'>(</span><span class='s1'>&#39;charset&#39;</span><span class='p'>,</span> <span class='s1'>&#39;utf-8&#39;</span><span class='p'>);</span>
<span class='lineno'>273</span> 
<span class='lineno'>274</span>         <span class='nx'>head</span><span class='p'>.</span><span class='nx'>appendChild</span><span class='p'>(</span><span class='nx'>script</span><span class='p'>);</span>
<span class='lineno'>275</span>         <span class='nx'>scripts</span><span class='p'>.</span><span class='nx'>push</span><span class='p'>(</span><span class='nx'>script</span><span class='p'>);</span>
<span class='lineno'>276</span>         <span class='nx'>head</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
<span class='lineno'>277</span>     <span class='p'>};</span>
<span class='lineno'>278</span> 
<span class='lineno'>279</span>     <span class='c1'>// misc - hide send button and show saving throbber instead</span>
<span class='lineno'>280</span>     <span class='kd'>function</span> <span class='nx'>showLoader</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>281</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>show</span><span class='p'>(</span><span class='nx'>savingThrobber</span><span class='p'>);</span>
<span class='lineno'>282</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>hide</span><span class='p'>(</span><span class='nx'>sendButton</span><span class='p'>);</span>
<span class='lineno'>283</span>     <span class='p'>};</span>
<span class='lineno'>284</span>     <span class='c1'>// misc - hide saving throbber and show send button instead</span>
<span class='lineno'>285</span>     <span class='kd'>function</span> <span class='nx'>hideLoader</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>286</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>hide</span><span class='p'>(</span><span class='nx'>savingThrobber</span><span class='p'>);</span>
<span class='lineno'>287</span>         <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>show</span><span class='p'>(</span><span class='nx'>sendButton</span><span class='p'>);</span>
<span class='lineno'>288</span>     <span class='p'>};</span>
<span class='lineno'>289</span> 
<span class='lineno'>290</span>     <span class='k'>return</span> <span class='p'>{</span>
<span class='lineno'>291</span>         <span class='nx'>initialize</span> <span class='o'>:</span> <span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>292</span>             <span class='nx'>createTemplate</span><span class='p'>();</span>
<span class='lineno'>293</span>             <span class='nx'>initializeDomElementsReferences</span><span class='p'>();</span>
<span class='lineno'>294</span>             <span class='nx'>initializeGUI</span><span class='p'>();</span>
<span class='lineno'>295</span>             <span class='nx'>attachListeners</span><span class='p'>();</span>
<span class='lineno'>296</span>             <span class='nx'>sendRequest</span><span class='p'>(</span><span class='nx'>wishlistsLocation</span><span class='p'>,</span> <span class='kc'>null</span><span class='p'>,</span> <span class='s1'>&#39;loadWishlists&#39;</span><span class='p'>);</span>
<span class='lineno'>297</span>         <span class='p'>},</span>
<span class='lineno'>298</span> 
<span class='lineno'>299</span>         <span class='nx'>destroy</span> <span class='o'>:</span> <span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>300</span>             <span class='nx'>destroy</span><span class='p'>();</span>
<span class='lineno'>301</span>         <span class='p'>},</span>
<span class='lineno'>302</span> 
<span class='lineno'>303</span>         <span class='nx'>loadWishlists</span> <span class='o'>:</span> <span class='nx'>activateWhishlistsDropdown</span><span class='p'>,</span>
<span class='lineno'>304</span> 
<span class='lineno'>305</span>         <span class='nx'>itemAdded</span> <span class='o'>:</span> <span class='nx'>clearFields</span>
<span class='lineno'>306</span>     <span class='p'>};</span>
<span class='lineno'>307</span> <span class='p'>}();</span>
<span class='lineno'>308</span> 
<span class='lineno'>309</span> <span class='c1'>// to prevent memory leaks, remove all js &lt;-&gt; dom references, including dom elements references and event listeners</span>
<span class='lineno'>310</span> <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>addListener</span><span class='p'>(</span><span class='nb'>window</span><span class='p'>,</span> <span class='s1'>&#39;unload&#39;</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span>
<span class='lineno'>311</span>     <span class='k'>if</span> <span class='p'>(</span><span class='nx'>allThat</span><span class='p'>)</span> <span class='nx'>allThat</span><span class='p'>.</span><span class='nx'>Bookmarklet</span><span class='p'>.</span><span class='nx'>destroy</span><span class='p'>();</span>
<span class='lineno'>312</span>     <span class='nx'>Dom</span><span class='p'>.</span><span class='nx'>removeListener</span><span class='p'>(</span><span class='nb'>window</span><span class='p'>,</span> <span class='s1'>&#39;unload&#39;</span><span class='p'>,</span> <span class='nx'>arguments</span><span class='p'>.</span><span class='nx'>callee</span><span class='p'>);</span>
<span class='lineno'>313</span> <span class='p'>});</span>
<span class='lineno'>314</span> 
<span class='lineno'>315</span> 
<span class='lineno'>316</span> <span class='nx'>allThat</span><span class='p'>.</span><span class='nx'>Bookmarklet</span><span class='p'>.</span><span class='nx'>initialize</span><span class='p'>();</span> <span class='c1'>// show bookmarklet - this is visual start of the application</span>
<span class='lineno'>317</span> 
<span class='lineno'>318</span> <span class='p'>})();</span>
</code></pre></div>
<p><strong>Примечания</strong>:</p>
<ul class='footnotes'>
    <li id='footnotes_wtf'>Вообще скрипт выполнен мной на заказ в рамках моей фрилансерской деятельности, так что не удивляйтесь идее, логотипам и дизайну. </li>
</ul>
		</div>
	</div><!-- close:post -->

	<div class="post" id="post-/posts/329/329">
		<h2><a href="/posts/329/index.html" rel="bookmark" title="Перевод нормальных слов в код">Перевод нормальных слов в код</a></h2>
		<span class="date">2009 / 02 / 06</span>
		<div class="entry">
			<p>Так, сегодня пришло в голову, решил записать. Не то, чтобы это очень уж смешная штука была, но забавная. Особенно в конце плодотворного рабочего дня :)</p>
<div class='highlight'><pre><code class='javascript'><span class='k'>for</span> <span class='p'>(</span><span class='kd'>var</span> <span class='nx'>mate</span> <span class='k'>in</span> <span class='nx'>addressBook</span><span class='p'>)</span> <span class='p'>{</span> 
    <span class='k'>if</span> <span class='p'>(</span><span class='nx'>mate</span><span class='p'>.</span><span class='nx'>blacklisted</span><span class='p'>)</span> <span class='p'>{</span> <span class='c1'>// Ко всем неприятным знакомым:</span>
        <span class='k'>if</span> <span class='p'>(</span><span class='nx'>calculateDistance</span><span class='p'>(</span><span class='nx'>Home</span><span class='p'>.</span><span class='nx'>getInstance</span><span class='p'>().</span><span class='nx'>getLatitude</span><span class='p'>(),</span> 
          <span class='nx'>mate</span><span class='p'>.</span><span class='nx'>getLatitude</span><span class='p'>())</span> <span class='o'>&lt;</span> <span class='mi'>100</span><span class='p'>)</span> <span class='p'>{</span> <span class='c1'>// будете проходить мимо -</span>
            <span class='k'>continue</span><span class='p'>;</span> <span class='c1'>// проходите</span>
        <span class='p'>}</span>
    <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
		</div>
	</div><!-- close:post -->

<div class="pagination clearfix">
    
    		
    		    <div class="prev"><a href="/page2/">&laquo; Newer</a></div>
    		

    		
    		    <div class="next"><a href="/page4/">Older &raquo;</a></div>
    		
    
</div>
	
    
		</div><!-- close:main-content -->
		<div id="sidebar" class="clearfix">
    <div id="sb-1">
        <a href="/about.html">About</a>
        <ul id="rss">
            <li><a href="http://feeds.feedburner.com/ulizko-com">RSS Feed of the articles</a></li>
        </ul>
    </div>
	<div id="sb-2">
		<a href="mailto:alexander@ulizko.com" class="email">alexander@ulizko.com</a>
		<br />
		<a href="http://twitter.com/aulizko" class="twitter">@aulizko</a>
		<br />
		<a href="http://http://www.facebook.com/profile.php?id=1002139259" class="facebook">Alexander Ulizko</a>
		<br />
		<a href="http://github.com/aulizko">github</a>
		<br />
		<a href="https://code.google.com/u/aulizko/">Google Code</a>
	</div><!-- close:sb-2 -->
</div><!-- close:sidebar -->
	    </div><!-- close:content -->
<div id="footer">
    <p>&copy;2008&nbsp;&mdash;&nbsp;2014 <a href="http://ulizko.com">Alexander Ulizko</a></p>
	<p>Powered by <a href="https://pages.github.com/">Github Pages</a> | generated by <a href="https://github.com/mojombo/jekyll">jekyll</a> | powered by <a href="http://disqus.com">disqus</a> | themed by <a href="http://www.vostoktheme.com" hreflang="en">Vostok Theme</a></p>
</div><!-- close:footer -->
</div><!-- close:wrapper -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4326533-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>